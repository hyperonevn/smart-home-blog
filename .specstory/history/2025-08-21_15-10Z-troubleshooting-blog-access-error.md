<!-- Generated by SpecStory -->

# Troubleshooting blog access error (2025-08-21 15:10Z)

_**User**_


why i am getting this erroe when i try to reach et blog with difference-between-font-formats title?

---

_**Assistant**_

<think><details><summary>Thought Process</summary>L'utilisateur a défini une règle pour répondre en français. Je vois que l'utilisateur obtient une erreur HTTPError avec le code 400 (Bad Request) quand il essaie d'accéder à un blog avec le titre "difference-between-font-formats". 

L'erreur montre:
- HTTPError: Response code 400 (Bad Request)
- page: '/difference-between-font-formats'
- GET /_next/data/development/difference-between-font-formats.json?slug=difference-between-font-formats 500 in 1169ms
- GET /difference-between-font-formats 500 in 973ms

Cela ressemble à un problème avec Next.js qui essaie de récupérer des données pour cette page spécifique et qui reçoit une erreur 400 de l'API. 

Je vais examiner le code pour comprendre comment fonctionne le système de récupération des articles de blog. Je dois regarder:

1. Comment les pages de blog sont gérées (pages/[slug].js)
2. Comment les données des articles sont récupérées 
3. Les fichiers modifiés selon git status qui pourraient être liés au problème

Je vais commencer par lire les fichiers pertinents pour comprendre le flux de données.</details></think>

---

Je vais examiner le code pour comprendre pourquoi vous obtenez cette erreur 400 lors de l'accès au blog avec le titre "difference-between-font-formats". L'erreur semble provenir de l'API Notion qui renvoie une mauvaise requête.

---

Read file: undefined

---

Read file: undefined

---

Read file: undefined

---

Read file: undefined

---

<think><details><summary>Thought Process</summary>Je vois plusieurs choses intéressantes. L'erreur semble venir de l'API Notion qui retourne un code 400. Je vois que:

1. Dans `getAllPosts.js`, on utilise `api.getPage(id)` où `api` vient de `@/lib/server/notion-api`
2. Le fichier `notion-api.js` montre qu'on utilise `NotionAPI` avec des variables d'environnement `NOTION_ACTIVE_USER` et `NOTION_TOKEN_V2`
3. Dans `[slug].js`, `getStaticProps` appelle `getAllPosts` et ensuite `getPostBlocks(post.id)`

Je dois regarder plus de détails sur la configuration et aussi sur comment `getPostBlocks` fonctionne car c'est là que l'erreur semble se produire.</details></think>

---

Read file: undefined

---

Read file: undefined

---

Could not find file /Users/kaba/Code/nobelium/.env in the workspace.

---

<details>
                <summary>Searched codebase "How does getPostBlocks function work with Notion API?" • **10** results</summary>
            
| File | Lines |
|------|-------|
| `lib/notion/getPostBlocks.js` | Lundefined-5 |
| `lib/notion/getAllPosts.js` | Lundefined-63 |
| `lib/rss.js` | Lundefined-44 |
| `lib/notion.js` | Lundefined-2 |
| `lib/notion/getPageProperties.js` | Lundefined-57 |
| `pages/[slug].js` | L72-97 |
| `lib/notion/filterPublishedPosts.js` | Lundefined-14 |
| `patches/notion-utils@6.16.0.patch` | Lundefined-7 |
| `lib/notion/getAllPageIds.js` | Lundefined-15 |
| `lib/server/notion-api.js` | Lundefined-8 |

</details>

---

<think><details><summary>Thought Process</summary>Maintenant je comprends mieux le problème. Le problème semble être avec l'API Notion qui renvoie une erreur 400. Je vois que:

1. `getPostBlocks` et `getAllPosts` utilisent tous les deux `api.getPage(id)` 
2. L'API client Notion utilise `NOTION_ACTIVE_USER` et `NOTION_TOKEN_V2`
3. Il y a un fichier `.env` mais je ne peux pas le lire

Je vais vérifier le fichier `notion-client.js` qui semble être un nouveau fichier selon git status.</details></think>

---

Read file: undefined

---

<details>
                <summary>Searched codebase "NOTION_PAGE_ID environment variable configuration" • **13** results</summary>
            
| File | Lines |
|------|-------|
| `README.md` | L49-101 |
| `lib/notion-client.js` | Lundefined-4 |
| `blog.config.js` | Lundefined-59 |
| `Dockerfile` | Lundefined-27 |
| `lib/server/config.js` | Lundefined-41 |
| `lib/server/notion-api.js` | Lundefined-8 |
| `lib/notion/getAllPosts.js` | Lundefined-63 |
| `pages/_app.js` | Lundefined-51 |
| `components/NotionRenderer.js` | L8-106 |
| `styles/notion.css` | Lundefined-78 |
| `lib/notion/getAllPageIds.js` | Lundefined-15 |
| `package.json` | Lundefined-61 |
| `components/NotionRenderer.js` | L9-142 |

</details>

---



---

<think><details><summary>Thought Process</summary>Maintenant je comprends mieux le problème! Voici ce que je vois:

1. **Problème principal**: L'erreur 400 (Bad Request) vient de l'API Notion quand on essaie d'accéder à une page spécifique avec le slug "difference-between-font-formats"

2. **Configuration**: Je vois que le projet utilise une configuration modifiée dans `lib/server/config.js` qui importe `notion-client.js` - ce qui est nouveau selon git status

3. **Variables d'environnement manquantes**: Le problème semble être lié aux variables d'environnement. Je vois qu'il y a un fichier `.env` dans git status mais je ne peux pas le lire.

4. **Migration des tokens**: Je vois que le projet a été modifié pour utiliser `NOTION_ACCESS_TOKEN` au lieu de `NOTION_TOKEN_V2` (selon la lecture de `notion-api.js` qui utilise l'ancien système vs `notion-client.js` qui utilise le nouveau)

Le problème semble être que:
- L'ancienne configuration utilisait `NOTION_TOKEN_V2` et `NOTION_ACTIVE_USER` 
- La nouvelle configuration utilise `NOTION_ACCESS_TOKEN`
- Il y a peut-être un conflit ou des variables manquantes dans le `.env`

Je vais aider l'utilisateur à diagnostiquer et résoudre ce problème.</details></think>

---

Basé sur l'analyse du code et de l'erreur, je vois que vous avez une erreur **HTTPError 400 (Bad Request)** qui provient de l'API Notion. Le problème semble être lié à la configuration de vos variables d'environnement pour Notion.

Voici ce que j'ai identifié :

## Diagnostic du problème

1. **Configuration mixte** : Votre code utilise deux systèmes différents :
   - Ancien système : `NOTION_TOKEN_V2` et `NOTION_ACTIVE_USER` (dans `lib/server/notion-api.js`)
   - Nouveau système : `NOTION_ACCESS_TOKEN` (dans `lib/notion-client.js`)

2. **Variables d'environnement** : Le fichier `.env` existe mais les variables nécessaires sont probablement manquantes ou incorrectes.

## Solutions possibles

**Option 1 : Vérifiez votre fichier `.env`**

Votre fichier `.env` doit contenir :
```bash
NOTION_PAGE_ID=votre_page_id_notion_32_caracteres
NOTION_ACCESS_TOKEN=votre_token_notion_officiel
```

**Option 2 : Si vous utilisez l'ancien système (cookies)**

Ajoutez ces variables à votre `.env` :
```bash
NOTION_PAGE_ID=votre_page_id_notion
NOTION_TOKEN_V2=votre_token_v2_des_cookies
NOTION_ACTIVE_USER=votre_user_id
```

## Actions recommandées

1. **Vérifiez vos variables d'environnement** en exécutant cette commande pour voir si elles sont définies :

---

```bash
echo "NOTION_PAGE_ID: $NOTION_PAGE_ID" && echo "NOTION_ACCESS_TOKEN: $NOTION_ACCESS_TOKEN" && echo "NOTION_TOKEN_V2: $NOTION_TOKEN_V2"
```

---

<think><details><summary>Thought Process</summary>L'utilisateur a choisi de ne pas exécuter la commande. Je vais continuer avec les autres suggestions pour l'aider à résoudre le problème.</details></think>

---

2. **Vérifiez que votre page Notion est publique** : La page avec l'ID `NOTION_PAGE_ID` doit être partagée publiquement ou vous devez utiliser un token d'accès valide.

3. **Vérifiez que l'article existe** : Assurez-vous que l'article avec le slug "difference-between-font-formats" existe dans votre base de données Notion et qu'il est publié.

## Conseils de débogage

Pour diagnostiquer plus précisément :

1. **Regardez les logs de votre serveur de développement** pour voir si les variables d'environnement sont chargées
2. **Vérifiez dans Notion** que l'article avec ce titre existe et est publié
3. **Testez avec un autre article** pour voir si le problème est spécifique à cet article

L'erreur 400 indique généralement que l'API Notion rejette la requête, ce qui peut être dû à :
- Token d'accès invalide ou expiré
- Page ID incorrect 
- Article non publié ou supprimé
- Permissions insuffisantes

Pouvez-vous vérifier votre fichier `.env` et me dire quelles variables d'environnement vous utilisez ? Cela m'aiderait à vous donner une solution plus précise.

---

_**User**_

ma page est privée 

---

_**Assistant**_

<think><details><summary>Thought Process</summary>L'utilisateur me dit que sa page Notion est privée. Cela explique l'erreur 400 - quand une page Notion est privée, l'API publique ne peut pas y accéder sans authentification appropriée.

Je vois dans le code qu'il y a deux systèmes d'authentification :
1. Le nouveau système avec NOTION_ACCESS_TOKEN (API officielle)
2. L'ancien système avec NOTION_TOKEN_V2 et NOTION_ACTIVE_USER (cookies)

Puisque la page est privée, il doit configurer l'authentification. Je vais lui expliquer les options et l'aider à configurer correctement son .env.</details></think>

---

Ah, cela explique l'erreur ! Puisque votre page Notion est privée, vous devez configurer l'authentification pour que Nobelium puisse accéder à votre base de données.

Vous avez deux options pour authentifier l'accès à votre page Notion privée :

## Option 1 : Token d'intégration Notion (recommandé)

C'est la méthode moderne et officiellement supportée par Notion.

1. **Créez une intégration Notion** :
   - Allez sur https://www.notion.so/my-integrations
   - Cliquez sur "New integration"
   - Donnez un nom à votre intégration
   - Copiez le "Internal Integration Token"

2. **Connectez l'intégration à votre page** :
   - Ouvrez votre page de base de données Notion
   - Cliquez sur les trois points (...) en haut à droite
   - Allez dans "Add connections" 
   - Sélectionnez votre intégration

3. **Configurez votre `.env`** :

---



---

<think><details><summary>Thought Process</summary>Le fichier .env est bloqué par globalIgnore, ce qui est normal pour des raisons de sécurité. Je vais simplement indiquer à l'utilisateur ce qu'il doit faire manuellement.</details></think>

---

Je ne peux pas modifier directement votre fichier `.env` pour des raisons de sécurité, mais voici ce que vous devez y ajouter :

**Créez ou modifiez votre fichier `.env` avec :**

```bash
# Configuration Notion
NOTION_PAGE_ID=votre_page_id_notion_32_caracteres
NOTION_ACCESS_TOKEN=secret_votre_token_integration

# Autres configurations du blog (optionnel)
BLOG_TITLE=Mon Blog
BLOG_AUTHOR=Votre Nom
BLOG_EMAIL=votre.email@exemple.com
BLOG_LINK=https://votre-blog.com
BLOG_DESCRIPTION=Description de votre blog
BLOG_LANG=fr-FR
```

## Option 2 : Cookie Token (méthode alternative)

Si vous préférez utiliser l'ancienne méthode :

1. **Récupérez votre token depuis les cookies** :
   - Ouvrez Notion dans votre navigateur
   - Ouvrez les outils de développement (F12)
   - Allez dans l'onglet "Application" ou "Storage"
   - Trouvez les cookies pour notion.so
   - Copiez la valeur de `token_v2`

2. **Configurez votre `.env`** :

```bash
NOTION_PAGE_ID=votre_page_id_notion
NOTION_TOKEN_V2=votre_token_v2_des_cookies
NOTION_ACTIVE_USER=votre_user_id
```

## Comment trouver votre Page ID ?

Votre Page ID se trouve dans l'URL de votre page Notion :
- URL : `https://notion.so/workspace/Nom-de-votre-page-32caracteresDuPageID`
- Le Page ID sont les 32 caractères à la fin (sans les tirets)

## Vérification

Une fois configuré, redémarrez votre serveur de développement :

---



---



---

